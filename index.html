<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Seguridad AquÃ­ Vecino</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1220">

<style>
:root{
  --bg:#0b1220;
  --panel:#14213d;
  --press:#1f3a8a;
  --txt:#ffffff;
  --mut:rgba(255,255,255,.8);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui, Arial, sans-serif;
  background:linear-gradient(180deg,#0b1220,#14213d);
  color:var(--txt);
}
header{
  padding:16px 12px 10px;
  text-align:center;
  position:relative;
}
header h1{margin:0;font-size:22px}
header p{margin:6px 0 0;font-size:13px;opacity:.85}
.settings{
  position:absolute;right:12px;top:14px;
  font-size:20px;cursor:pointer;opacity:.85;
}
.settings:active{transform:scale(.9)}

.section{padding:14px}
.section h3{margin:8px 0 12px;font-size:14px;opacity:.9}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
.grid.big{
  grid-template-columns:repeat(3,1fr);
}
.tile{
  background:var(--panel);
  border-radius:18px;
  padding:14px 8px;
  text-align:center;
  cursor:pointer;
  user-select:none;
  transition:transform .06s ease, background .15s ease, box-shadow .15s ease;
  box-shadow:0 8px 18px rgba(0,0,0,.25);
}
.tile:active{
  transform:scale(.94);
  background:var(--press);
}
.icon{font-size:34px;line-height:1}
.label{margin-top:6px;font-weight:800;font-size:13px}
.sub{font-size:12px;color:var(--mut);margin-top:2px}

.fire{background:#b91c1c}
.rob{background:#d97706}
.med{background:#047857}
.siren{background:#7f1d1d}
.call{background:#1f2a44}

.status{
  text-align:center;
  font-size:12px;
  color:var(--mut);
  margin-top:8px;
}

/* ===== MODAL AJUSTES ===== */
.modalBg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  padding:14px;
}
.modal{
  width:100%;
  max-width:420px;
  background:#0f1a33;
  border-radius:18px;
  padding:14px;
}
.modal h4{margin:0 0 10px}
.field{margin-bottom:10px}
.field label{font-size:12px;opacity:.9}
.field input{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:none;
  background:#1f2a44;
  color:#fff;
}
.btn{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:none;
  background:#2563eb;
  color:#fff;
  font-weight:800;
  cursor:pointer;
}
.btn.secondary{background:#374151;margin-top:8px}
</style>
</head>

<body>

<header>
  <div class="settings" onclick="openSettings()">âš™ï¸</div>
  <h1>Seguridad AquÃ­ Vecino</h1>
  <p>ChiloÃ© Â· Para un ChiloÃ© mÃ¡s seguro</p>
</header>

<!-- EMERGENCIAS COMUNITARIAS -->
<div class="section">
  <h3>ğŸš¨ Aviso inmediato a la comunidad (WhatsApp + GPS)</h3>
  <div class="grid big">
    <div class="tile fire" onclick="sendAlert('ğŸ”¥ INCENDIO FORESTAL')">
      <div class="icon">ğŸ”¥</div>
      <div class="label">Incendio</div>
    </div>
    <div class="tile rob" onclick="sendAlert('ğŸš¨ ROBO / ASALTO')">
      <div class="icon">ğŸš¨</div>
      <div class="label">Robo</div>
    </div>
    <div class="tile med" onclick="sendAlert('ğŸš‘ EMERGENCIA MÃ‰DICA')">
      <div class="icon">ğŸš‘</div>
      <div class="label">MÃ©dica</div>
    </div>
  </div>
  <div class="status" id="status">Pulsa un botÃ³n para avisar a la comunidad</div>
</div>

<!-- PÃNICO FÃSICO -->
<div class="section">
  <h3>ğŸ”Š PÃ¡nico fÃ­sico (alarma sonora)</h3>
  <div class="grid">
    <div class="tile siren" onclick="toggleSiren()">
      <div class="icon">ğŸ”Š</div>
      <div class="label">Sirena</div>
    </div>
  </div>
</div>

<!-- EMERGENCIAS OFICIALES -->
<div class="section">
  <h3>ğŸ“ Emergencias oficiales (llamada)</h3>
  <div class="grid">
    <div class="tile call" onclick="call('131')"><div class="icon">ğŸš‘</div><div class="label">SAMU</div><div class="sub">131</div></div>
    <div class="tile call" onclick="call('132')"><div class="icon">ğŸš’</div><div class="label">Bomberos</div><div class="sub">132</div></div>
    <div class="tile call" onclick="call('133')"><div class="icon">ğŸ‘®</div><div class="label">Carabineros</div><div class="sub">133</div></div>
    <div class="tile call" onclick="call('134')"><div class="icon">ğŸ•µï¸</div><div class="label">PDI</div><div class="sub">134</div></div>
    <div class="tile call" onclick="call('130')"><div class="icon">ğŸŒ²</div><div class="label">CONAF</div><div class="sub">130</div></div>
    <div class="tile call" onclick="call('*4242')"><div class="icon">ğŸ“£</div><div class="label">Denuncia</div><div class="sub">*4242</div></div>
    <div class="tile call" onclick="call('*4141')"><div class="icon">ğŸ§ </div><div class="label">Salud</div><div class="sub">*4141</div></div>
    <div class="tile call" onclick="call('223451100')"><div class="icon">ğŸ„</div><div class="label">SAG</div><div class="sub">Denuncias</div></div>
    <div class="tile call" onclick="call('1427')"><div class="icon">ğŸ›ï¸</div><div class="label">Castro</div><div class="sub">1427</div></div>
    <div class="tile call" onclick="call('1527')"><div class="icon">ğŸ›ï¸</div><div class="label">QuilpuÃ©</div><div class="sub">1527</div></div>
    <div class="tile call" onclick="call(planNum)"><div class="icon">ğŸš“</div><div class="label">Plan Cuadrante</div></div>
    <div class="tile call" onclick="call(freeNum)"><div class="icon">â­</div><div class="label">Contacto Libre</div></div>
  </div>
</div>

<!-- AJUSTES -->
<div class="modalBg" id="modalBg">
  <div class="modal">
    <h4>âš™ï¸ Ajustes</h4>
    <div class="field">
      <label>Plan Cuadrante (telÃ©fono)</label>
      <input id="planInput" placeholder="Ej: 9XXXXXXXX">
    </div>
    <div class="field">
      <label>Contacto Libre (telÃ©fono)</label>
      <input id="freeInput" placeholder="Ej: 9XXXXXXXX">
    </div>
    <button class="btn" onclick="saveSettings()">Guardar</button>
    <button class="btn secondary" onclick="closeSettings()">Cerrar</button>
  </div>
</div>

<script>
/* ===== CONFIGURACIÃ“N CLAVE ===== */
const WHATSAPP_GROUP_LINK =
  "https://chat.whatsapp.com/LpLiMQTMeW8BzvY5CSsimV";
/* ============================== */

let planNum = localStorage.getItem("planNum") || "";
let freeNum = localStorage.getItem("freeNum") || "";

function call(num){
  if(num) location.href = "tel:" + num;
}

function sendAlert(type){
  const st = document.getElementById("status");
  st.textContent = "Obteniendo ubicaciÃ³nâ€¦";

  navigator.geolocation.getCurrentPosition(pos=>{
    const msg =
`${type}
ğŸ“ https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}
Seguridad AquÃ­ Vecino Â· ChiloÃ©`;

    st.textContent = "Abriendo WhatsAppâ€¦";
    location.href =
      WHATSAPP_GROUP_LINK + "?text=" + encodeURIComponent(msg);
  },()=>{
    st.textContent = "No se pudo obtener ubicaciÃ³n";
  });
}

/* ===== SIRENA REAL, AGRESIVA ===== */
let audioCtx=null, osc=null, gain=null, sirenTimer=null;
function toggleSiren(){
  if(osc){ stopSiren(); return; }

  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  osc = audioCtx.createOscillator();
  gain = audioCtx.createGain();

  osc.type = "square";
  osc.frequency.value = 1200;
  gain.gain.value = 0.7;

  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();

  let hi=true;
  sirenTimer = setInterval(()=>{
    osc.frequency.value = hi ? 1600 : 700;
    hi=!hi;
  },300);

  if(navigator.vibrate){
    navigator.vibrate([600,200,600,200,600]);
  }
}
function stopSiren(){
  clearInterval(sirenTimer);
  if(osc){
    osc.stop();
    osc.disconnect();
    gain.disconnect();
  }
  osc=null;
  if(navigator.vibrate) navigator.vibrate(0);
}

/* ===== AJUSTES ===== */
function openSettings(){
  document.getElementById("modalBg").style.display="flex";
  planInput.value = planNum;
  freeInput.value = freeNum;
}
function closeSettings(){
  document.getElementById("modalBg").style.display="none";
}
function saveSettings(){
  planNum = planInput.value.trim();
  freeNum = freeInput.value.trim();
  localStorage.setItem("planNum", planNum);
  localStorage.setItem("freeNum", freeNum);
  closeSettings();
}
</script>

</body>
</html>
